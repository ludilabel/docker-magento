#!/usr/bin/env bash
set -o errexit

# Arguments:
# $1 : (Optionnel) mysqldump_win_path : Chemin Windows où déposer le fichier backup.

source bin/wsl-fn

if [ "$1" ]; then
  mysqldump_win_path="$1"
else
  echo "Veuillez coller le chemin Windows où déposer le fichier de backup"
  read -r -p "(ex : D:\projects\magento\mysql\backups) : " mysqldump_win_path
fi

wsl_mysqldump_win_path=$(convertWinPathToWslPath "$mysqldump_win_path")

# Vérifier si le chemin existe
if [ ! -d "$wsl_mysqldump_win_path" ]; then
    echo "Le chemin spécifié n'existe pas."
    exit 1
fi

echo "Génération du backup et copie du fichier dans Windows"
file_name="backup_docker_$(date +%Y%m%d_%H%M%S).sql"
bin/n98-magerun2 db:dump --stdout > "$wsl_mysqldump_win_path/$file_name" 2>/dev/null

echo "Le fichier est prêt dans $mysqldump_win_path/$file_name"
