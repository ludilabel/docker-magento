#!/usr/bin/env bash
set -o errexit

# Arguments :
# (Optionnel) $1 : win_sources_path chemin Windows vers les fichiers sources Magento 2

source env/dev-setup-config.env
source bin/terminal-colors
source bin/wsl-fn


if [ "$1" ]; then
  win_sources_path="$1"
else
  if [ "$OS_SRC" ]; then
      wsl_sources_path="$OS_SRC"
      echo "Le chemin est déjà configuré : $(yellow "$OS_SRC")"
  else
    echo "Veuillez coller le chemin Windows vers les fichiers sources Magento 2"
    read -r -p "(ex : D:\Travail\Ludilabel\Magento2) : " win_sources_path
  fi
fi

if [[ ! "$OS_SRC" || "$1"]]; then
   wsl_sources_path=$(convertWinPathToWslPath "$win_sources_path")
  else
   wsl_sources_path="$win_sources_path"
fi

# Vérifier si le chemin existe
if [ ! -d "$wsl_sources_path" ]; then
    echo "Le chemin spécifié n'existe pas : $wsl_sources_path"
    exit 1
fi

if [ "$OS_SRC" ]; then
  if [ "$1" ]; then
    sed -i "s|^OS_SRC=.*|OS_SRC=\"$wsl_sources_path\"|" env/dev-setup-config.env
  fi
else
    echo "Ajout de la variable OS_SRC à la fin du fichier env/dev-setup-config.env."
    echo "OS_SRC=\"$wsl_sources_path\"" >> env/dev-setup-config.env
fi

