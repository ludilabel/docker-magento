#!/usr/bin/env bash
set -o errexit

source bin/wsl-fn

echo "Veuillez coller le chemin Windows vers le dossier où déposer le fichier rootCA.pem"
read -r -p "(ex : D:\projets\Magento2\nginx) : " destination_win_path

wsl_destination_win_path=$(convertWinPathToWslPath "$destination_win_path")

# Vérifier si le chemin existe
if [ ! -d "$wsl_destination_win_path" ]; then
    echo "Le chemin spécifié n'existe pas."
    exit 1
fi


echo "conversion du rootCA.pem en rootCA.crt pour Windows"
docker cp "$(bin/docker-compose ps -q app|awk '{print $1}')":/root/.local/share/mkcert/rootCA.pem .
openssl x509 -outform der -in rootCA.pem -out rootCA.crt
rsync -av --delete "rootCA.crt" "$wsl_destination_win_path"
rm rootCA.pem rootCA.crt

echo "Le fichier a été téléchargé dans le dossier Windows. Double cliquer sur le fichier pour installer l'autorité de certification"
