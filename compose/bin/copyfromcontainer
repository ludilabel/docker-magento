#!/usr/bin/env bash
[ -z "$1" ] && echo "Please specify a directory or file to copy from container (ex. vendor, --all)" && exit

source env/dev-setup-config.env

DOCKER_SERVICE="phpfpm"
CONTAINER_ID=$(bin/docker-compose ps -q $DOCKER_SERVICE | awk '{print $1}')

HOST_SRC=$(cd -P "$TRANSFER_PATH" && pwd)
if [ ! -d "$HOST_SRC" ]; then
  mkdir -p "$HOST_SRC"
fi
if [ "$1" == "--all" ]; then
  docker cp "$CONTAINER_ID":/var/www/html/./ "$HOST_SRC/"
  echo "Completed copying all files from container to host"

  rsync -av --delete --exclude='.git' --exclude='.idea' "$HOST_SRC/" "$OS_SRC"
  echo "Completed copying from Debian to Windows"

else
  if [ -f "$1" ] ; then
    docker cp "$CONTAINER_ID":/var/www/html/"$1" "$HOST_SRC/$1"
    rsync -av --delete --exclude='.git' --exclude='.idea' "$HOST_SRC/$1" "$OS_SRC"

  else
    docker cp "$CONTAINER_ID":/var/www/html/"$1" "$HOST_SRC/$(dirname "$1")"
    rsync -av --delete --exclude='.git' --exclude='.idea' "$HOST_SRC/$1/" "$OS_SRC/$1"

  fi
  echo "Completed copying from container to host"
  echo "Completed copying $1 from Debian to Windows"
fi
