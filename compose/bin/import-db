#!/usr/bin/env bash

# Arguments:
#   fichier_sql (Optionnel) Chemin vers un fichier SQL à importer.
#     Si non fourni, l'utilisateur devra choisir entre importer une base de données de recette ou un fichier SQL local.

source env/dev-setup-config.env
source bin/import-db-fn

# Si un chemin vers un fichier sql est fourni, on l'importe
if [ "$1" ]; then
  sql_file="$1"
  echo "En cas d'erreur, avez-vous utilisé des quotes autour du chemin ?"
  echo 'Usage: bin/* "chemin"'
  if [[ "$sql_file" == *.sql ]]; then
    import_param_sql "$sql_file"
  else
    echo "Erreur : Le fichier $sql_file fourni ne termine pas par .sql."
    exit 1
  fi

else
  # Sinon on donne le choix au développeur
  echo "Quelle base de données souhaitez-vous importer ?"
  echo "1) Recette"
  echo "2) Depuis un fichier .sql local"
  read -r -p "Entrez votre choix [1 ou 2] : " choice

  case $choice in
    1)
      import_recette
      ;;
    2)
      import_prompt_sql
      ;;
  esac
fi

if [ $? -ne 0 ]; then
    echo "Erreur lors de l'importation de la base de données"
    exit 1
fi

# Configuration de la base de données
if [ "$USAGE_MODE" != "install" ]; then
  source bin/after-import-db-config-inc
fi