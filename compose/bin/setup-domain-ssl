#!/usr/bin/env bash
set -o errexit

source env/setup/magento-stores.env

# listes de données dans env/magento-stores.env
# boutiques Magento 2
declare -A store_codes
for entry in ${TLD_STORE_MAP}; do
  store_codes[${entry%%:*}]=${entry##*:}
done


source env/dev-setup-config.env

echo "Veuillez saisir le nom de domaine pour accéder aux boutiques Magento 2 localement"
read -r -p "(ex : franz.docker.ludilabel) sans le suffixe du domaine de premier niveau (.fr,...) : " DN

# Initialize an array to hold entries that need to be added
ALL_FQDN=()

# Loop through each top-level domain and prepare the corresponding entry
for TLD in "${!store_codes[@]}"; do
    ALL_FQDN+=("$DN.$TLD")
done

echo "Generating SSL certificates..."
bin/setup-ssl "${ALL_FQDN[@]}"
